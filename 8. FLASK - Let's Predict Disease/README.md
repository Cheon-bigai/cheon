# ODIR 안구질환 분석 웹 애플리케이션

ODIR(Ocular Disease Intelligent Recognition) 데이터셋을 활용하여 안구 이미지에서 8가지 질환을 분석하는 웹 애플리케이션입니다.

## 프로젝트 개요

이 프로젝트는 딥러닝을 활용한 안구질환 분석 시스템으로, 다음 기능을 제공합니다:

1. **안구 이미지 분석**: 업로드한 안구 이미지에서 8가지 질환에 대한 확률을 분석
2. **데이터베이스 관리**: CSV 파일을 MySQL 데이터베이스에 업로드하고 관리
3. **데이터 조회 및 통계**: 데이터베이스에 저장된 데이터 조회 및 통계 정보 시각화

## 폴더 구조

```
ODIR_Web_App/
│
├── code/                  # 코드 폴더
│   ├── odir_analysis.py   # 이미지 분석 및 모델 관련 코드
│   └── web_app.py         # Flask 웹 애플리케이션 코드
│
├── data/                  # 데이터 폴더
│   ├── train_images/      # 훈련 이미지 
│   ├── test_images/       # 테스트 이미지
│   ├── models/            # 모델 저장 폴더
│   └── uploads/           # 업로드된 이미지 저장 폴더
│
├── templates/             # HTML 템플릿
│   ├── layout.html        # 기본 레이아웃
│   ├── index.html         # 메인 페이지
│   ├── upload.html        # 이미지 업로드 페이지
│   ├── result.html        # 분석 결과 페이지
│   ├── view_data.html     # 데이터 조회 페이지
│   ├── stats.html         # 통계 페이지
│   └── db_admin.html      # DB 관리 페이지
│
├── static/                # 정적 파일(CSS, JS, 이미지 등)
│
├── run_app.py             # 애플리케이션 실행 스크립트
└── README.md              # 사용 설명서
```

## 설치 및 실행 방법

### 1. 필수 라이브러리 설치

```bash
pip install torch torchvision pandas numpy flask pillow opencv-python sqlalchemy mysql-connector-python scikit-learn
```

### 2. 데이터 준비

1. 안구 이미지 데이터를 `data/train_images`와 `data/test_images` 폴더에 복사합니다.
2. CSV 파일을 `data` 폴더에 `full_df.csv`로 복사합니다.

### 3. 애플리케이션 실행

#### 자동 DB 업로드 없이 실행:
```bash
python run_app.py
```

#### CSV 파일을 자동으로 DB에 업로드하며 실행:
```bash
python run_app.py --upload-csv
```

### 4. 웹 접속

웹 브라우저에서 다음 주소로 접속:
```
http://localhost:5000
```

## 주요 기능

### 1. 안구질환 분석
- 안구 이미지 업로드 및 분석
- 8가지 질환에 대한 확률 계산 (정상, 당뇨병, 녹내장, 백내장, AMD, 고혈압, 근시, 기타)
- 그래프를 통한 분석 결과 시각화

### 2. 데이터베이스 관리
- CSV 파일을 MySQL 데이터베이스에 업로드
- 테이블 이름 및 업로드 방식 선택 가능 (추가/교체)
- 데이터베이스 통계 조회

### 3. 데이터 조회
- 데이터베이스에 저장된 레코드 조회
- 표시할 레코드 수 선택 가능

### 4. 통계 정보
- 질환별 분포 시각화
- 질환 간 공존 관계 분석

## 데이터베이스 설정

기본 데이터베이스 설정:
- 호스트: 192.168.2.154
- 포트: 3306
- 데이터베이스: g6
- 사용자: 2
- 비밀번호: 1234
- 테이블: odir_data

데이터베이스 설정을 변경하려면 `code/web_app.py` 파일의 `DB_URL` 변수를 수정하세요.

## 주의사항

1. 이 애플리케이션의 분석 결과는 참고용으로만 사용하시고, 정확한 진단은 반드시 의사와 상담하세요.
2. 대용량 데이터 조회 시 브라우저 성능이 저하될 수 있습니다.
3. 실제 서비스 환경에 배포할 경우 보안 설정을 추가로 적용해야 합니다.

## 문제 해결

1. **데이터베이스 연결 오류**: 
   - DB_URL 설정이 올바른지 확인
   - MySQL 서버가 실행 중인지 확인
   - 사용자 계정에 데이터베이스 접근 권한이 있는지 확인

2. **이미지 분석 오류**:
   - 이미지 파일 형식이 JPG, PNG인지 확인
   - 모델 파일이 `data/models` 폴더에 있는지 확인

3. **CSV 업로드 오류**:
   - CSV 파일 형식이 올바른지 확인
   - 필수 컬럼(N, D, G, C, A, H, M, O)이 포함되어 있는지 확인
