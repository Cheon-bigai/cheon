# NCAA 농구 승부 예측 프로젝트

## 프로젝트 개요

이 프로젝트는 2025 전미 대학 체육 협회(NCAA) 농구 경기의 승부를 예측하는 모델을 개발하였습니다. 팀의 숨겨진 상태(팀 컨디션, 분위기 등)가 경기 결과에 미치는 영향을 분석하기 위해 Hidden Markov Model(HMM)을 사용하였습니다.

## 데이터셋

### 주요 파일 및 컬럼 설명

#### 1. 경기 결과 요약 (RegularSeasonCompactResults / NCAATourneyCompactResults)
- Season: 시즌 연도
- DayNum: 시즌 시작일로부터의 경기 날짜(1~132)
- WTeamID/LTeamID: 승리/패배 팀 ID
- WScore/LScore: 승리/패배 팀 점수
- WLoc: 승리 팀 경기 장소(H:홈, A:어웨이, N:중립)
- NumOT: 연장전 횟수

#### 2. 상세 경기 통계 (RegularSeasonDetailedResults / NCAATourneyDetailedResults)
- 기본정보: Season, DayNum, WTeamID, LTeamID, WScore, LScore, WLoc, NumOT
- 승리팀 통계:
  - WFGM/WFGA: 필드골 성공/시도 수
  - WFGM3/WFGA3: 3점슛 성공/시도 수
  - WFTM/WFTA: 자유투 성공/시도 수
  - WOR/WDR: 공격/수비 리바운드
  - WAst: 어시스트
  - WTO: 턴오버
  - WStl: 스틸
  - WBlk: 블록
  - WPF: 파울
- 패배팀 통계: L로 시작하는 동일 항목들(LFGM, LFGA 등)

#### 3. 토너먼트 시드 (NCAATourneySeeds)
- Season: 시즌 연도
- Seed: 토너먼트 내 팀 배정 순위(예: W01, X16)
- TeamID: 팀 ID

#### 4. 팀 정보 (Teams)
- TeamID: 팀 고유 ID
- TeamName: 팀 이름

#### 5. 랭킹 정보 (MasseyOrdinals)
- Season: 시즌 연도
- SystemName: 랭킹 시스템 이름
- RankingDayNum: 랭킹 산출일
- TeamID: 팀 ID
- OrdinalRank: 해당 시스템의 팀 순위

### 파생 컬럼
- winRatio: 팀 시즌 승률
- GapAvg: 평균 점수 차
- SeedDiff: 두 팀 간 시드 차이
- GapAvgDiff: 두 팀 간 평균 점수 차이
- winRatioDiff: 두 팀 간 승률 차이

## 분석 모델

### Hidden Markov Model (HMM)

- **선정 이유**: 스포츠 경기 결과는 단순히 표면적인 데이터로만 설명되지 않으며, 팀 컨디션, 선수들의 심리 상태, 팀워크 등 직접 관측하기 어려운 요인들이 결과에 큰 영향을 미친다는 가설을 검증하기 위해 선택하였습니다.
- **모델 특징**:
  - 숨겨진 상태 가정: 팀의 실제 '상태'(좋은/나쁜 컨디션 등)는 직접 관찰할 수 없지만, 이 상태가 승패 결과에 영향을 준다고 가정합니다.
  - 시계열 데이터 분석에 적합: 경기 결과는 시간 순서를 가진 데이터로, HMM은 이런 시간적 의존성을 모델링하는 데 효과적입니다.
  - 상태 전이 파악: 팀이 어떤 상태에서 다른 상태로 전환되는 확률적 패턴을 학습할 수 있습니다.

### 핵심 알고리즘
- **Baum-Welch 알고리즘**: 관측값으로부터 최적의 전이 확률과 방출 확률을 학습
- **Viterbi 알고리즘**: 관측값 시퀀스가 주어졌을 때, 가장 가능성 높은 숨겨진 상태 시퀀스 찾기

### 모델 파라미터
- **HMM 종류**: MultinomialHMM (이산 관측값에 적합)
- **n_components**: 2 (두 가지 숨겨진 상태 가정) - 팀 내 분위기, 개인 컨디션을 좋음/나쁨으로 단순화
- **n_iter**: 1000 (학습 반복 횟수) - 충분한 학습 보장
- **요인(feature)**: TeamID, Season, DayNum(시계열) 
- **결과**: 승패(0, 1)
- **훈련/테스트 분할**: 70% 훈련, 30% 테스트

## 분석 결과

### EDA를 통한 분석
- 2000년 이후 평균 승리 수 기준 상위 10개 팀을 강팀으로 정의하고 분석한 결과, 홈/어웨이/중립 경기장별 승률 차이가 뚜렷하게 나타났습니다.
- 대부분의 강팀들은 홈 경기에서 50-70%의 승률을 보인 반면, 원정에서는 25-40%로 승률이 크게 떨어졌습니다.
- 이는 '홈강팀'은 강팀만의 승률을 유지시켜주는 숨겨진 요인이 있을 것이라는 가설을 뒷받침합니다.

### 모델 성능 평가
- **팀 1202 (2025시즌)**:
  - R² = 0.973
  - MSE = 0.129
  - 예측 승수: 24~25승
  - 예측 오차: ±0.5승

### 평가지표
- **로그 우도(Log Likelihood)**: HMM이 승패 데이터를 얼마나 잘 설명하는지 측정하기 위해 사용하였습니다.
- **AIC와 BIC**: 모델의 복잡도와 성능 간의 균형을 평가하기 위해 사용하였습니다.

### 교차분석
- **교차 검증 결과 (TimeSeriesSplit)**:
  - 평균 R² = 0.856
  - 평균 MSE = 0.235
- 시간 순서를 고려한 교차 검증에서도 안정적인 성능을 보였습니다.

### HMM vs 단순 평균 모델 비교
- HMM 모델(n_features=2)과 단순 평균 승률 기반 모델(n_features=0)을 비교한 결과, HMM 모델이 실제 누적 승수와 더 가까운 예측을 제공했습니다.
- 팀의 컨디션이 변화하는 구간에서 HMM의 예측 정확도가 더 높았습니다. 이는 "숨겨진 요인이 존재한다"는 가설을 입증하는 결과입니다.

## 한계점 및 개선 가능성

### 현재 모델의 한계
- **단순한 특성 사용**: 현재 모델은 승/패(0/1) 결과만 사용하여 제한적인 정보를 바탕으로 예측합니다.
- **이분법적 상태 가정**: n_components=2로 설정하여 두 가지 상태만 고려했으나, 실제로는 더 복잡한 상태가 존재할 수 있습니다.
- **팀 간 상호작용 무시**: 상대팀의 강도를 고려하지 않아 예측의 정확도가 제한됩니다.

### 해결 방법
- **추가 특성 도입**: 경기 장소(홈/원정), 점수 차이, 팀 구성 변화 등의 추가 특성을 포함하면 예측 성능이 향상될 것입니다.
- **복잡한 모델 시도**: n_components > 2인 모델이나 GaussianHMM 등 다른 유형의 HMM을 시도하면 더 정교한 상태 모델링이 가능할 것입니다.

## 프로젝트 회고

### 주요 학습 포인트
1. **데이터 분석 성능 지표 선정 중요성**:
   - 결정계수도 중요하지만 오차를 확인하는 것이 중요합니다.
   - 일정한 오차(편향)가 있으면 R²가 낮게 나올 수 있기 때문에, 오차 패턴을 확인하는 것이 중요했습니다.
   - "결과를 설명하는데 피쳐 자체만 아니라 숨겨진 어떠한 요인이 있다"는 것을 HMM을 통해 확인할 수 있었습니다.

2. **모델 선택의 중요성**:
   - 처음에는 단순한 회귀 모델을 고려했지만, 시계열 데이터의 특성과 팀의 '숨겨진 상태'를 고려하기 위해 HMM을 선택했습니다.
   - 이 선택이 프로젝트의 방향을 결정짓는 중요한 순간이었고, 결과적으로 더 흥미로운 분석을 가능하게 했습니다.

3. **데이터 시각화의 중요성**:
   - 실제 누적 승수와 예측 누적 승수를 비교한 그래프, 잔차 플롯, 강팀들의 홈/어웨이/중립 경기장별 승률 시각화 등을 통해 모델의 성능과 패턴을 직관적으로 파악할 수 있었습니다.
   - 교차 검증 결과를 시각화한 폴드별 그래프는 모델의 안정성을 평가하는 데 큰 도움이 되었습니다.

4. **장비의 중요성**:
   - 머신러닝 모델을 노트북으로 돌렸는데 CPU로만 작업을 하여 작업 시간이 매우 오래 걸렸습니다.
   - 딥러닝 및 머신러닝이 각광받는 이유는 기술의 발달로 처리 속도가 빨라졌기 때문이며, GPU 업그레이드의 필요성을 느꼈습니다.

## 설치 및 사용 방법

### 필수 라이브러리
```
pandas
numpy
matplotlib
scikit-learn
hmmlearn
```

### 설치 방법
```bash
pip install pandas numpy matplotlib scikit-learn hmmlearn
```

### 사용 방법
1. 데이터셋 준비: 데이터 폴더에 필요한 CSV 파일들을 위치시킵니다.
2. 전처리 스크립트 실행: 데이터를 읽고 전처리합니다.
3. HMM 모델 훈련: 팀ID와 시즌을 선택하여 모델을 훈련시킵니다.
4. 결과 평가: 예측 결과를 시각화하고 성능 지표를 확인합니다.

## 라이센스
이 프로젝트는 MIT 라이센스 하에 배포됩니다.
